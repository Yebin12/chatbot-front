<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />
    

    <link rel="stylesheet" href="./global.css" />
    <link rel="stylesheet" href="./index.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Open Sans:wght@400;700&display=swap"
    />
  </head>
  <body>
    <div class="empty-state-test">
      <div class="sidebar">
        <img
          class="ubc-logo-2018-narrowsig-white-icon"
          loading="eager"
          alt=""
          src="./public/ubclogo2018narrowsigwhitergb72-1@2x.png"
        />

        <div class="frame-button-secondary">
          <button class="button-secondary" id="buttonSecondary">
            <div class="content">
              <b class="text">New Chat</b>
              <img class="icon" alt="" src="./public/icon.svg" />
            </div>
          </button>
          <button class="button-secondary" id="button-data-visualize">
            <div class="content">
              <b class="text">View Data-Flow</b>
            </div>
          </button>
        </div>
      </div>
      <main class="main-content">
        <section class="u-b-c-r-a-g-l-l-m-frame">
          <div class="ubc-rag-llm">UBC RAG LLM 1.0</div>
          <div class="frame-button-secondary">
            <button class="button-secondary1" id="buttonSecondary1">
              <div class="content">
                <b class="text1">End Session</b>
              </div>
            </button>
          </div>
        </section>

        <div class="scroll" style="display: none;">
          <!-- <div class="rectangle-frame" style="display: none;">
            <b class="heading">Admin</b>
            <div class="can-i-propose">
              Placeholder
            </div>
          </div> -->
        </div>

        <h1 class="welcome-how-can-container" id="welcome-message">
          <span>
            <p class="welcome">Welcome,</p>
            <p class="how-can-we">How can I help you today?</p>
          </span>
        </h1>
        <section class="cards">
          <div class="row-1">
            <button class="card">
              <b class="heading">What is UBC Retrieval Augmented Generation (RAG)?</b>
              <div class="body-copy">
                Upload a file in the chat below, to check against the
                latest UBC policies.
              </div>
            </button>
            <button class="card1">
              <b class="heading1">How can I be certain that my data will be kept secure?</b>
              <div class="body-copy1">
                See what UBC RAG can and can't do. 
              </div>
            </button>
          </div>
          <div class="row-2">
            <button class="card2">
              <b class="heading2">Can you check if my project may get approved?</b>
              <div class="body-copy2">
                See how UBC RAG maintain secure system preventing data leakage. 
              </div>
            </button>
            <button class="card3">
              <b class="heading3">What are some policies regarding academic misconduct?</b>
              <div class="body-copy3">
                See the relevant policies about academic misconduct            
              </div>
            </button>
          </div>
        </section>

        <footer class="search-bar">
          <button class="button-file">
            <div class="button-file-child"></div>
            <img
              class="button-attach-icon"
              alt=""
              src="./public/buttonattach.svg"
            />
          </button>

          <input
            class="write-your-question"
            placeholder="Write your question here"
            type="text"
            id="messageInput"
          />

          <button class="button-submit">
            <div class="button-submit-child"></div>
            <img
              class="button-submit-icon"
              alt=""
              src="./public/buttonsubmit.svg"
            />
          </button>
        </footer>

        <div id="messagesContainer"></div>
        
        <div class="disclaimer">
          UBC RAG LLM can make mistakes. Consider consulting the latest
          available UBC policies when necessary.
        </div>
      </main>
    </div>

    <div id="modalEndSeshPopup" class="popup-overlay" style="display: none">
      <div class="modal-end-sesh">
        <section class="end-session-frame">
          <h3 class="end-session">End Session?</h3>
          <div class="if-you-want">
            If you want to immediately delete your data, please press ‘delete’. To download and delete your data, press 'download'.
          </div>
        </section>
        <section class="delete-confirm-frame">
          <div class="frame-group">
            <button class="rectangle-parent" id="deleteButton">
              <div class="frame-child"></div>
              <div class="delete">Delete</div>
            </button>
            <button class="rectangle-parent">
              <div class="frame-child"></div>
              <div class="delete">Download</div>
            </button>
          </div>
        </section>
      </div>
    </div>

    <div id="deleteDataModal" class="popup-overlay" style="display: none">
      <div class="modal-delete-data">
        <section class="modal-frame">
          <div class="deleting-data-frame">
            <h3 class="deleting-data">Deleting Data</h3>
          </div>
          <div class="your-data-will">
            Your data will be permanently deleted from the system.
          </div>
        </section>
        <div class="frame-with-icons">
          <img class="icons2" loading="lazy" alt="" src="./public/icons.svg" />

          <div class="frame-with-group">
            <img
              class="frame-with-group-child"
              loading="lazy"
              alt=""
              src="./public/group-68.svg"
            />
          </div>
          <img class="icons3" loading="lazy" alt="" src="./public/icons-11.svg" />
        </div>
      </div>
    </div> 
    
    <div id="deleteSuccessModal" class="popup-overlay" style="display: none">
      <div class="modal-deletedata-sucess">
        <section class="modal-frame">
          <div class="frame-with-success-message">
            <h3 class="success">Success</h3>
            <div class="your-data-has">Your data has been successfully deleted</div>
          </div> 
            <img class="icons4" loading="lazy" alt="" src="./public/checkcircle.svg" />
            <div class="frame-group">
              <button class="rectangle-parent-success" id="successButton">
                <div class="frame-child"></div>
                <div class="close">Close</div>
              </button>
              </div>
        </section> 
      </div> 
    </div>
    

  <script>
    var buttonSecondary = document.getElementById("buttonSecondary");
      if (buttonSecondary) {
        buttonSecondary.addEventListener("click", function () {
          var popup = document.getElementById("modalEndSeshPopup");
          if (!popup) return;
          var popupStyle = popup.style;
          if (popupStyle) {
            popupStyle.display = "flex"; // Make the popup visible
            popupStyle.zIndex = "100"; // Ensure it's on top of other content
            popupStyle.backgroundColor = "rgba(0, 0, 0, 0.4)"; // Semi-transparent background
            popupStyle.alignItems = "center"; // Center the inner content vertically
            popupStyle.justifyContent = "center"; // Center the inner content horizontally
          }
          popup.setAttribute("closable", "");
      
          var onClick =
            popup.onClick ||
            function (e) {
              if (e.target === popup && popup.hasAttribute("closable")) {
                popupStyle.display = "none";
              }
            };
          popup.addEventListener("click", onClick);
        });
      }
      
      var topNavContainer = document.getElementById("topNavContainer");
      if (topNavContainer) {
        topNavContainer.addEventListener("click", function () {
          var popup = document.getElementById("modalEndSeshPopup");
          if (!popup) return;
          var popupStyle = popup.style;
          if (popupStyle) {
            popupStyle.display = "flex";
            popupStyle.zIndex = 100;
            popupStyle.backgroundColor = "rgba(113, 113, 113, 0.3)";
            popupStyle.alignItems = "center";
            popupStyle.justifyContent = "center";
          }
          popup.setAttribute("closable", "");
      
          var onClick =
            popup.onClick ||
            function (e) {
              if (e.target === popup && popup.hasAttribute("closable")) {
                popupStyle.display = "none";
              }
            };
          popup.addEventListener("click", onClick);
        });
      }

      var buttonSecondary1 = document.getElementById("buttonSecondary1");
      if (buttonSecondary1) {
        buttonSecondary1.addEventListener("click", function () {
          var popup = document.getElementById("modalEndSeshPopup");
          if (!popup) return;
          var popupStyle = popup.style;
          if (popupStyle) {
            popupStyle.display = "flex"; // Make the popup visible
            popupStyle.zIndex = "100"; // Ensure it's on top of other content
            popupStyle.backgroundColor = "rgba(0, 0, 0, 0.4)"; // Semi-transparent background
            popupStyle.alignItems = "center"; // Center the inner content vertically
            popupStyle.justifyContent = "center"; // Center the inner content horizontally
          }
          popup.setAttribute("closable", "");
      
          var onClick =
            popup.onClick ||
            function (e) {
              if (e.target === popup && popup.hasAttribute("closable")) {
                popupStyle.display = "none";
              }
            };
          popup.addEventListener("click", onClick);
        });
      }
      
      var topNavContainer = document.getElementById("topNavContainer");
      if (topNavContainer) {
        topNavContainer.addEventListener("click", function () {
          var popup = document.getElementById("modalEndSeshPopup");
          if (!popup) return;
          var popupStyle = popup.style;
          if (popupStyle) {
            popupStyle.display = "flex";
            popupStyle.zIndex = 100;
            popupStyle.backgroundColor = "rgba(113, 113, 113, 0.3)";
            popupStyle.alignItems = "center";
            popupStyle.justifyContent = "center";
          }
          popup.setAttribute("closable", "");
          var onClick =
            popup.onClick ||
            function (e) {
              if (e.target === popup && popup.hasAttribute("closable")) {
                popupStyle.display = "none";
              }
            };
          popup.addEventListener("click", onClick);
        });
      }

      var deleteButton = document.getElementById("deleteButton");
      if (deleteButton) {
        deleteButton.addEventListener("click", function() {
          var deleteDataModal = document.getElementById("deleteDataModal");
          if (!deleteDataModal) return;
          var modalStyle = deleteDataModal.style;
          modalStyle.display = "flex";
          modalStyle.zIndex = "101"; // Ensure it appears above the End Session Modal
          modalStyle.backgroundColor = "rgba(0, 0, 0, 0.4)";
          modalStyle.alignItems = "center";
          modalStyle.justifyContent = "center";
          
          deleteDataModal.setAttribute("closable", "");

          var onClick =
          deleteDataModal.onClick ||
            function (e) {
              if (e.target === deleteDataModal && deleteDataModal.hasAttribute("closable")) {
                modalStyle.display = "none";
              }
            };
            deleteDataModal.addEventListener("click", onClick);
        });
      }

      var deleteButton = document.getElementById("deleteButton");
      var downloadButton = document.getElementById("downloadButton");
      var modalEndSeshPopup = document.getElementById("modalEndSeshPopup");

      if (deleteButton) {
        deleteButton.addEventListener("click", function() {
          modalEndSeshPopup.style.display = "none";
        });
      }

      if (downloadButton) {
        downloadButton.addEventListener("click", function() {
          modalEndSeshPopup.style.display = "none";
        });
      }

      document.getElementById("deleteButton").addEventListener("click", function() {

      setTimeout(function() {
        
        document.getElementById('deleteDataModal').style.display = 'none';
         
        var deleteSuccessModal = document.getElementById('deleteSuccessModal');
        deleteSuccessModal.style.display = 'flex';

      }, 2000); 
    }); 

    var closeButton = document.getElementById("successButton");
    if (closeButton) {
      closeButton.addEventListener("click", function() {
        var deleteSuccessModal = document.getElementById('deleteSuccessModal');
        if (deleteSuccessModal) {
          deleteSuccessModal.style.display = 'none';
        }
      });
    }

    var cards = document.querySelectorAll('.card, .card1, .card2, .card3'); 
    var welcomeMessage = document.getElementById('welcome-message');
    var scrollPanel = document.querySelector('.scroll');

    function createTextBubble(messageText, isUserInput) {
      if (messageText) {
        var newBubble = document.createElement('div');
        newBubble.classList.add(isUserInput ? 'rectangle-frame' : 'rectangle-frame-UBG');
        
        var bubbleHeading = document.createElement('b');
        bubbleHeading.classList.add('heading');
        bubbleHeading.textContent = isUserInput ? "User" : "UBC LLM"; 
        
        var bubbleText = document.createElement('div');
        bubbleText.classList.add('can-i-propose');
        bubbleText.textContent = messageText; 

        newBubble.appendChild(bubbleHeading);
        newBubble.appendChild(bubbleText);

        var scrollPanel = document.querySelector('.scroll');
        scrollPanel.style.display = 'block';
        scrollPanel.appendChild(newBubble); 

        scrollPanel.scrollTop = scrollPanel.scrollHeight;

        document.getElementById('messageInput').value = '';
        cards.forEach(card => card.style.display = 'none');
        welcomeMessage.style.display = 'none';

      }
    }


    // Adding an event listener to each card
    cards.forEach(function(card) {
      card.addEventListener('click', function() {
        // Finds the first element within the card that has a class name starting with 'heading'
        var headingElement = card.querySelector('[class^="heading"]');
        if (headingElement) {
          var headingText = headingElement.textContent.trim(); // Gets the content of the heading
          createTextBubble(headingText); // Creates a text bubble with the heading's content
        }
      });
    });


    document.querySelector('.button-submit').addEventListener('click', async function() {
      var messageInput = document.getElementById('messageInput');
      var userInput = messageInput.value.trim();
      if (userInput) {
        createTextBubble(userInput, true); // Create a bubble for user input

        // Simulate fetching a response from UBC LLM
        setTimeout(() => {
          var llmResponse = "UBC-RAG";
          createTextBubble(llmResponse, false); // Create a bubble for UBC LLM response
        }, 1000); // Simulating response time

        messageInput.value = ''; // Clear the input field
      }
    });


    // Event listener for the Enter key in the message input
    document.getElementById('messageInput').addEventListener('keypress', function(event) {
      if (event.key === "Enter") {
        event.preventDefault();
        createTextBubble(messageInput.value.trim());
      }
    });

    document.getElementById('messageInput').addEventListener('input', function() {
      if (this.value.length > 0) {
        this.style.color = 'black'; // Change font color to black when user types
      } else {
        this.style.color = 'var(--gray-2)'; // Revert to gray when input is empty
      }
    });

    document.getElementById('button-data-visualize').addEventListener('click', function() {
      window.open('./gifDisplay.html', '_blank');
    });
    
    </script>
  </body>
</html>